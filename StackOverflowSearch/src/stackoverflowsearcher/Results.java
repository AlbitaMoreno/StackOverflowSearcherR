package stackoverflowsearcher;


import java.awt.Color;
import java.awt.Dimension;
import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.logging.Level;
import java.util.logging.Logger;
import javafx.util.Pair;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import javax.swing.ScrollPaneConstants;
import org.apache.lucene.queryparser.classic.ParseException;

public class Results extends javax.swing.JFrame {

    private String query;
    
    
    public Results(String q) {
        initComponents();
        
        this.query = q;
        
        // Pongo título
        this.setTitle("Results");
        
        // Color JFrame
        this.getContentPane().setBackground(new Color(226,154,1));
        
        // Centrar pantalla
        this.setLocationRelativeTo(null);
        
        // Comprobar si se ha creado el directorio de índices y de facetas
        File ff = new File("./../../facet");
        File fi = new File("./../../index");
        
        List<Pair<String, String>> resultSearch = new ArrayList<>();
        if(ff.isDirectory() && ff.list().length > 0 && fi.isDirectory() && fi.list().length > 0) {
            // Obtener resultados
            IndexSearch iS = null;
            try {
                iS = new IndexSearch(this.query);
                resultSearch = iS.getResultSearch();
                System.out.println(resultSearch);
            } catch (IOException | ParseException ex) {
                Logger.getLogger(Results.class.getName()).log(Level.SEVERE, null, ex);
            }
            Map<String, Number> resultFacet = iS.getResultFacet();
            System.out.println(resultFacet);
        }
        
        int size = resultSearch.size() / 4;
        
        res.setPreferredSize(new Dimension(600, 120*size + 5*(size+1)));
        JTextArea ta;         
        JScrollPane sp;
        
        for(int i=0;i<(size*4);i+=4) {
            String text = "";
            for(int j=i; j<(i+4); j++) {
                Pair<String,String> p = resultSearch.get(j);
                if(p.getValue() != null) text += (p.getKey() + " = " + p.getValue() + "\n");
            }
            ta = new JTextArea(text);
            ta.setEditable(false);
            ta.setBounds(5, 5 + (120*(i/4)) + (5*(i/4)) , 550, 120);
            
            sp = new JScrollPane(ta);
            sp.setBounds(5, 5 + (120*(i/4)) + (5*(i/4)) , 550, 120);
            sp.setVerticalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_AS_NEEDED);
            
            res.add(sp);
        }
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        title = new javax.swing.JLabel();
        scroll = new javax.swing.JScrollPane();
        res = new javax.swing.JPanel();
        questions = new javax.swing.JCheckBox();
        title_f = new javax.swing.JLabel();
        answers = new javax.swing.JCheckBox();
        answer_accept_yes = new javax.swing.JCheckBox();
        high_score = new javax.swing.JCheckBox();
        medium_score = new javax.swing.JCheckBox();
        low_score = new javax.swing.JCheckBox();
        title_score = new javax.swing.JLabel();
        tag = new javax.swing.JCheckBox();
        tag_name = new javax.swing.JTextField();
        creation_date = new javax.swing.JCheckBox();
        creation_date_month = new com.toedter.calendar.JMonthChooser();
        creation_date_year = new com.toedter.calendar.JYearChooser();
        title_accept = new javax.swing.JLabel();
        answer_accept_no = new javax.swing.JCheckBox();
        creation_date1 = new javax.swing.JCheckBox();
        creation_date_year1 = new com.toedter.calendar.JYearChooser();
        filter_search_button = new javax.swing.JButton();
        menubar = new javax.swing.JMenuBar();
        opt = new javax.swing.JMenu();
        ini = new javax.swing.JMenuItem();
        out = new javax.swing.JMenuItem();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        title.setFont(new java.awt.Font("Ubuntu", 0, 18)); // NOI18N
        title.setForeground(new java.awt.Color(254, 254, 254));
        title.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        title.setText("Results");

        res.setPreferredSize(new java.awt.Dimension(600, 1354));

        javax.swing.GroupLayout resLayout = new javax.swing.GroupLayout(res);
        res.setLayout(resLayout);
        resLayout.setHorizontalGroup(
            resLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 600, Short.MAX_VALUE)
        );
        resLayout.setVerticalGroup(
            resLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 1354, Short.MAX_VALUE)
        );

        scroll.setViewportView(res);

        questions.setText("Questions");

        title_f.setFont(new java.awt.Font("Ubuntu", 0, 18)); // NOI18N
        title_f.setForeground(new java.awt.Color(254, 254, 254));
        title_f.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        title_f.setText("Facets");

        answers.setText("Answers");

        answer_accept_yes.setText("Yes");

        high_score.setText("High");

        medium_score.setText("Medium");

        low_score.setText("Low");

        title_score.setText("Score");

        tag.setText("Tag");

        creation_date.setText("Creation Date");

        title_accept.setText("Accepted Answer");

        answer_accept_no.setText("No");
        answer_accept_no.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                answer_accept_noActionPerformed(evt);
            }
        });

        creation_date1.setText("Creation Date");

        filter_search_button.setText("Filter Search");
        filter_search_button.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                filter_search_buttonActionPerformed(evt);
            }
        });

        opt.setText("Options");

        ini.setText("Start");
        ini.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                iniActionPerformed(evt);
            }
        });
        opt.add(ini);

        out.setText("Exit");
        out.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                outActionPerformed(evt);
            }
        });
        opt.add(out);

        menubar.add(opt);

        setJMenuBar(menubar);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(36, 36, 36)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(questions)
                            .addComponent(answers)
                            .addGroup(layout.createSequentialGroup()
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addComponent(title_f)
                                    .addGroup(layout.createSequentialGroup()
                                        .addComponent(title_accept)
                                        .addGap(18, 18, 18)
                                        .addComponent(answer_accept_yes)))
                                .addGap(18, 18, 18)
                                .addComponent(answer_accept_no))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(title_score)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(high_score)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(medium_score)
                                .addGap(18, 18, 18)
                                .addComponent(low_score))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(tag)
                                .addGap(18, 18, 18)
                                .addComponent(tag_name, javax.swing.GroupLayout.PREFERRED_SIZE, 141, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(creation_date)
                                .addGap(10, 10, 10)
                                .addComponent(creation_date_month, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(18, 18, 18)
                                .addComponent(creation_date_year, javax.swing.GroupLayout.PREFERRED_SIZE, 60, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(creation_date1)
                                .addGap(30, 30, 30)
                                .addComponent(creation_date_year1, javax.swing.GroupLayout.PREFERRED_SIZE, 60, javax.swing.GroupLayout.PREFERRED_SIZE))))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(125, 125, 125)
                        .addComponent(filter_search_button)))
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(41, 41, 41)
                        .addComponent(scroll, javax.swing.GroupLayout.PREFERRED_SIZE, 588, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(title)
                        .addGap(264, 264, 264))))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(title, javax.swing.GroupLayout.PREFERRED_SIZE, 48, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(12, 12, 12)
                        .addComponent(scroll, javax.swing.GroupLayout.PREFERRED_SIZE, 438, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(34, 34, 34)
                        .addComponent(title_f, javax.swing.GroupLayout.PREFERRED_SIZE, 48, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(20, 20, 20)
                        .addComponent(questions)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(answers)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(answer_accept_yes)
                            .addComponent(title_accept)
                            .addComponent(answer_accept_no))
                        .addGap(9, 9, 9)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(title_score)
                            .addComponent(high_score)
                            .addComponent(medium_score)
                            .addComponent(low_score))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(tag)
                            .addComponent(tag_name, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(creation_date)
                            .addComponent(creation_date_month, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(creation_date_year, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(creation_date1)
                            .addComponent(creation_date_year1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18)
                        .addComponent(filter_search_button)))
                .addContainerGap(23, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void iniActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_iniActionPerformed
        StackOverflowSearch s = new StackOverflowSearch();
        s.setVisible(true);
        this.dispose();
    }//GEN-LAST:event_iniActionPerformed

    private void outActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_outActionPerformed
        System.exit(0);
    }//GEN-LAST:event_outActionPerformed

    private void answer_accept_noActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_answer_accept_noActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_answer_accept_noActionPerformed

    private void filter_search_buttonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_filter_search_buttonActionPerformed
        // if(questions.isSelected())
        res.removeAll();
        res.repaint();
    }//GEN-LAST:event_filter_search_buttonActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JCheckBox answer_accept_no;
    private javax.swing.JCheckBox answer_accept_yes;
    private javax.swing.JCheckBox answers;
    private javax.swing.JCheckBox creation_date;
    private javax.swing.JCheckBox creation_date1;
    private com.toedter.calendar.JMonthChooser creation_date_month;
    private com.toedter.calendar.JYearChooser creation_date_year;
    private com.toedter.calendar.JYearChooser creation_date_year1;
    private javax.swing.JButton filter_search_button;
    private javax.swing.JCheckBox high_score;
    private javax.swing.JMenuItem ini;
    private javax.swing.JCheckBox low_score;
    private javax.swing.JCheckBox medium_score;
    private javax.swing.JMenuBar menubar;
    private javax.swing.JMenu opt;
    private javax.swing.JMenuItem out;
    private javax.swing.JCheckBox questions;
    private javax.swing.JPanel res;
    private javax.swing.JScrollPane scroll;
    private javax.swing.JCheckBox tag;
    private javax.swing.JTextField tag_name;
    private javax.swing.JLabel title;
    private javax.swing.JLabel title_accept;
    private javax.swing.JLabel title_f;
    private javax.swing.JLabel title_score;
    // End of variables declaration//GEN-END:variables
}
